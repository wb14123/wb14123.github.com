<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> A Library to Make It Easier to Use Scala with gRPC |  Bin Wang - My Personal Blog</title>
    <link rel="stylesheet" href="/static/css/default.css" type="text/css" />

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-52904500-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
    <header id="page_header">
      <nav id="page_nav">
        <ul>
             <li><a href="/">Home</a></li>
             <li><a href="/index_page.html">Index</a></li>
             <li><a href="/snippets">Snippets</a></li>
             <li><a href="https://www.goodreads.com/review/list/103708630-bin?shelf=read" target="_blank">Read</a></li>
             <li><a href="/travel.html">Travel</a></li>
             <li><a href="/search.html">Search</a></li>
             <li><a href="/about.html">About</a></li>
             <li><a href="/feed.xml">RSS</a></li>
       </ul>
      </nav>

    </header>

    <section id="page_content">
      <div id="content_table">
  
</div>

<div id="article_content" class="">
<article id="post">
  <header>
    <h1>A Library to Make It Easier to Use Scala with gRPC</h1>
    
      <p class="description">Posted on 02 May 2022, tagged <code>Programming</code><code>Scala</code><code>gRPC</code><code>backend</code></p>
    
  </header>

  <p><em>This article describes why I created the library <a href="https://github.com/wb14123/scala2grpc">Scala2grpc</a>.</em></p>

<p><a href="https://grpc.io/">gPRC</a> is a Remote Procedure Call (RPC) framework made by Google. It uses a domain specific language (DSL) to define the APIs, and provides tools for lots of languages to generate code for both servers and clients. The generated code includes models and API interfaces. The developer can create a gRPC server by implementing the generated interfaces. There are lots of examples in the official document so I’ll not spend more time on the details.</p>

<p>It has lots of advantages compared to traditional HTTP APIs that encode payloads as JSON or XML. Just to name a few: it’s type safe so there are less places to make errors; it has a schema so causes less confusing when communicate APIs between developers; it’s more efficient on both serialization and translation. Because of the advantages and the big name behind it, it’s very popular, especially for mobile apps because of the good client support.</p>

<p>However, I feel the framework is very invasive: models are usually the foundations of a program. With gRPC, the models are generated by the framework, as well as the interfaces. This makes the whole program depends on the framework very heavily. Here is an example:</p>

<div class="language-scala highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>// ExampleService is generated by gRPC
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>class ExampleServiceImpl() extends ExampleService {
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>        // ExampleInput and ExampleOutput are both generated by gRPC.
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>        def exampleAPI(input ExampleInput): ExampleOut = {
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>                ...
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>  }
<span class="line-numbers"><a href="#n7" name="n7">7</a></span>}
<span class="line-numbers"><a href="#n8" name="n8">8</a></span>
</pre></div>
</div>
</div>

<p>It’s more invasive than most of the (non RPC) libraries: for most of other libraries, you can define the interface and use those libraries to fill in the implementations, so when you change a library you don’t need to change other parts of the code.</p>

<p>Maybe sometimes it doesn’t matter too much: say you are Google and this framework is so fundamental in the services that no one is gonna to change it. But if you don’t like it, a way to work around this is to define the business logic at another place, and invoke those native classes and methods in the implementation of the gRPC generated interfaces. The logic in these implementations should be as simple as possible, usually just the invoking of methods and the converting between gRPC models and native models. Here is an example of this approach:</p>

<div class="language-scala highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>// define natvie classes
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>case class MyInput(...)
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>case class MyOutput(...)
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>class MyService() {
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>        def myAPI(input MyInput): MyOutput = {
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>                ...
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>        }
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>}
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>// implement gRPC interfaces
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>// ExampleService is generated by gRPC
<span class="line-numbers"><a href="#n15" name="n15">15</a></span>class ExampleServiceImpl(val myService: MyService) extends ExampleService {
<span class="line-numbers"><a href="#n16" name="n16">16</a></span>
<span class="line-numbers"><a href="#n17" name="n17">17</a></span>        // ExampleInput and ExampleOutput are both generated by gRPC.
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>        def exampleAPI(input ExampleInput): ExampleOut = {
<span class="line-numbers"><a href="#n19" name="n19">19</a></span>                val myInput = convertFromGRPC(input)
<span class="line-numbers"><strong><a href="#n20" name="n20">20</a></strong></span>                val myOutput = myService.myAPI(myInput)
<span class="line-numbers"><a href="#n21" name="n21">21</a></span>                convertToGRPC(myOutput)
<span class="line-numbers"><a href="#n22" name="n22">22</a></span>  }
<span class="line-numbers"><a href="#n23" name="n23">23</a></span>}
<span class="line-numbers"><a href="#n24" name="n24">24</a></span>
<span class="line-numbers"><a href="#n25" name="n25">25</a></span>// implement convertFromGRPC ...
<span class="line-numbers"><a href="#n26" name="n26">26</a></span>// implement convertToGRPC ...
<span class="line-numbers"><a href="#n27" name="n27">27</a></span>
</pre></div>
</div>
</div>

<p>However, this results lots of repeated works, especially for the converting between gRPC models and native models.</p>

<p>So here is where the sbt plugin Scala2grpc I’ve written comes in: it will generate all the proto files from the native Scala classes, and also generates the classes to convert between native models and gPRC models, and the classes to implement the gPRC interfaces. For example, in the example above, you only needs to write the code for <code>MyInput</code>, <code>MyOutput</code> and <code>MyService</code>, the generation of the proto files are handled by Scala2grpc, as well as <code>ExampleServiceImpl</code>, <code>convertFromGRPC</code> and <code>convertToGRPC</code>.</p>

<p>Sounds interesting? Check out the <a href="https://github.com/wb14123/scala2grpc">Github page</a> to see how to use it. Don’t forget to star it if you find it helpful!</p>

</article>

<footer id="post_footer">
  <table><tr>
    
      <td id="prev"><a href="/2022-04-24-A-Travel-to-Montreal.html">Prev: A Travel to Montreal</a></td>
    
    
      <td id="next"><a href="/2022-08-20-Apple-In-App-Purchase-Server-to-Server-Notification-Handling-with-Scala-Java.html" id="next">Next: Handle Apple In-App-Purchase Server Notification with Scala/Java</a></td>
    
  </tr></table>
</footer>

<section id="comment">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'crazy-hot-ice'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



<!-- MathJax -->
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

</div>

    </section>

    <footer id="page_footer">
      Copyright @ 2008 - 2022 Bin Wang
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.
    </footer>
  </body>
</html>
